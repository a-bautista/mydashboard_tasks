{% extends "base.html" %}

<script>
  {% block jquery %}
      data = {{converted_front_end_dictionary | safe}}

      var year  = data.year
      var month  = data.month
      var table_results  = data.table_results
      var labels = data.labels_graph
      var values = data.values_graph

      //console.log(values);
      document.getElementById("display_year").innerHTML = year;
      document.getElementById("display_month").innerHTML = month;

      setChart();
      $('#results').DataTable({
          data: table_results
      });

      function setChart()
      {

        var graph = document.getElementById("graph")
        var display_graph = new Chart(graph, {
        type:'pie',
        plugins: [ChartDataLabels],
        data: {
            labels: labels,
            datasets :
                [{
                  data: values,
                  backgroundColor: [
                      'rgba(237, 98, 18, 0.9)',
                      'rgba(54, 162, 235, 0.9)',
                      'rgba(255, 206, 86, 0.9)',
                      'rgba(75, 192, 192, 0.9)',
                      'rgba(153, 102, 255, 0.9)',
                      'rgba(45, 154, 35, 0.9)',
                      'rgba(154, 39, 35, 0.9)',
                      ],
                  borderColor: '#000',
                  borderWidth: 2,
                  hoverBorderWidth: 3,
                  hoverBorderColor: '#000'
                }]
        },
        options : {
              responsive: true,
              maintainAspectRatio: false,
              layout: {
                padding: {
                  top: 30,
                  bottom: 50,
                  right: 0,
                  left: 10
                }
              },
              plugins: {
                  legend:{
                    display: true,
                    position: 'right',
                    labels: {
                      color: '#000',
                      font:{
                        size: 15,
                      }
                    }
                  },
                title: {
                    display: true,
                    text: 'Categories of Tasks per Month',
                    font: {
                      size:20
                    },
                    padding: {
                      top: 5,
                      bottom: 15,
                      left: 0,
                      right: 0                  
                    },
                    color: '#000'
                    },
                  datalabels: {
                    align: center,
                    anchor: center,
                    formatter: (value, ctx) => {
                      let sum = 0;
                      let dataArr = ctx.chart.data.datasets[0].data;
                        dataArr.map(data => {
                            sum += data;
                        });
                        let percentage = (value*100 / sum).toFixed(2)+"%";
                        return percentage;
                      },
                      labels:{
                        value:{
                          color: '#fff'
                        } // end of values
                      } // end of labels
                    }, // end of datalabels
                  } // end of options
                } // end of plugins
              }); // end of display_graph variable
            } // end of function
  {% endblock %}
</script>

{% block content %}

<div style="display:inline-block">
  <h4 style="color:#000">Current year: <span id="display_year"></span></h4>
</div>


<div style="display:inline-block">
  <h4 style="color:#000">Current month: <span id="display_month"></span></h4>
</div>
<br />

<div class="widget-box sample-widget">
  <div class="widget-content">
    <canvas id="graph" width="700" height="400"></canvas>
  </div>
</div>
<br />

{% endblock content %}
